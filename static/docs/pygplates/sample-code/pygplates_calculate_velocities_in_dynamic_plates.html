

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculate velocities in dynamic plates &mdash; pygplates 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=78492a5e" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Find nearest reconstructed feature to a point" href="pygplates_find_nearest_feature_to_a_point.html" />
    <link rel="prev" title="Calculate velocities by plate ID" href="pygplates_calculate_velocities_by_plate_id.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pygplates
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pygplates_introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pygplates_getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pygplates_primer.html">Primer</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pygplates_sample_code.html">Sample code</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../pygplates_sample_code.html#import">Import</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pygplates_sample_code.html#load-save">Load/Save</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pygplates_sample_code.html#create-query-features">Create/query features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pygplates_sample_code.html#reconstruct-features">Reconstruct features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pygplates_sample_code.html#rotations">Rotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pygplates_sample_code.html#topologies">Topologies</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../pygplates_sample_code.html#velocities">Velocities</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="pygplates_calculate_velocities_by_plate_id.html">Calculate velocities by plate ID</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Calculate velocities in dynamic plates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#calculate-velocities-by-assigning-plate-ids-of-dynamic-plates-to-static-points">Calculate velocities by assigning plate IDs of dynamic plates to static points</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculate-velocities-by-grouping-static-points-into-dynamic-plates">Calculate velocities by grouping static points into dynamic plates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculate-velocities-by-individually-partitioning-each-static-point-into-dynamic-plates">Calculate velocities by individually partitioning each static point into dynamic plates</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pygplates_sample_code.html#spatial-proximity">Spatial proximity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pygplates_sample_code.html#isochrons">Isochrons</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pygplates_reference.html">Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pygplates</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../pygplates_sample_code.html">Sample code</a></li>
      <li class="breadcrumb-item active">Calculate velocities in dynamic plates</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/sample-code/pygplates_calculate_velocities_in_dynamic_plates.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="calculate-velocities-in-dynamic-plates">
<span id="pygplates-calculate-velocities-in-dynamic-plates"></span><h1>Calculate velocities in dynamic plates<a class="headerlink" href="#calculate-velocities-in-dynamic-plates" title="Link to this heading"></a></h1>
<p>This example shows three similar ways to calculate velocities of topological plates at static point locations.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#calculate-velocities-by-assigning-plate-ids-of-dynamic-plates-to-static-points" id="id3">Calculate velocities by assigning plate IDs of dynamic plates to static points</a></p>
<ul>
<li><p><a class="reference internal" href="#sample-code" id="id4">Sample code</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#calculate-velocities-by-grouping-static-points-into-dynamic-plates" id="id5">Calculate velocities by grouping static points into dynamic plates</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id6">Sample code</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#calculate-velocities-by-individually-partitioning-each-static-point-into-dynamic-plates" id="id7">Calculate velocities by individually partitioning each static point into dynamic plates</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id8">Sample code</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="calculate-velocities-by-assigning-plate-ids-of-dynamic-plates-to-static-points">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Calculate velocities by assigning plate IDs of dynamic plates to static points</a><a class="headerlink" href="#calculate-velocities-by-assigning-plate-ids-of-dynamic-plates-to-static-points" title="Link to this heading"></a></h2>
<section id="sample-code">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Sample code</a><a class="headerlink" href="#sample-code" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pygplates</span>


<span class="c1"># Load one or more rotation files into a rotation model.</span>
<span class="n">rotation_model</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">RotationModel</span><span class="p">(</span><span class="s1">&#39;rotations.rot&#39;</span><span class="p">)</span>

<span class="c1"># Load the topological plate polygon features.</span>
<span class="n">topology_features</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="s1">&#39;dynamic_polygons.gpml&#39;</span><span class="p">)</span>

<span class="c1"># Load the features that contain the geometries we will calculate velocities at.</span>
<span class="c1"># These can be generated in GPlates via the menu &#39;Features &gt; Generate Velocity Domain Points&#39;.</span>
<span class="n">velocity_domain_features</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="s1">&#39;lat_lon_velocity_domain_90_180.gpml&#39;</span><span class="p">)</span>

<span class="c1"># Calculate velocities using a delta time interval of 1My.</span>
<span class="n">delta_time</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Our geological times will be from 0Ma to &#39;num_time_steps&#39; Ma (inclusive) in 1 My intervals.</span>
<span class="n">num_time_steps</span> <span class="o">=</span> <span class="mi">140</span>

<span class="c1"># &#39;time&#39; = 0, 1, 2, ... , 140</span>
<span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_time_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

    <span class="nb">print</span> <span class="s1">&#39;Time: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">time</span>

    <span class="c1"># All domain points and associated (magnitude, azimuth, inclination) velocities for the current time.</span>
    <span class="n">all_domain_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_velocities</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Partition our velocity domain features into our topological plate polygons at the current &#39;time&#39;.</span>
    <span class="n">partitioned_domain_features</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">partition_into_plates</span><span class="p">(</span>
        <span class="n">topology_features</span><span class="p">,</span>
        <span class="n">rotation_model</span><span class="p">,</span>
        <span class="n">velocity_domain_features</span><span class="p">,</span>
        <span class="n">reconstruction_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">partitioned_domain_feature</span> <span class="ow">in</span> <span class="n">partitioned_domain_features</span><span class="p">:</span>

        <span class="c1"># We need the newly assigned plate ID to get the equivalent stage rotation of that tectonic plate.</span>
        <span class="n">partitioning_plate_id</span> <span class="o">=</span> <span class="n">partitioned_domain_feature</span><span class="o">.</span><span class="n">get_reconstruction_plate_id</span><span class="p">()</span>

        <span class="c1"># Get the stage rotation of partitioning plate from &#39;time + delta_time&#39; to &#39;time&#39;.</span>
        <span class="n">equivalent_stage_rotation</span> <span class="o">=</span> <span class="n">rotation_model</span><span class="o">.</span><span class="n">get_rotation</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">partitioning_plate_id</span><span class="p">,</span> <span class="n">time</span> <span class="o">+</span> <span class="n">delta_time</span><span class="p">)</span>

        <span class="c1"># A velocity domain feature usually has a single geometry but we&#39;ll assume it can be any number.</span>
        <span class="c1"># Iterate over them all.</span>
        <span class="k">for</span> <span class="n">partitioned_domain_geometry</span> <span class="ow">in</span> <span class="n">partitioned_domain_feature</span><span class="o">.</span><span class="n">get_geometries</span><span class="p">():</span>

            <span class="n">partitioned_domain_points</span> <span class="o">=</span> <span class="n">partitioned_domain_geometry</span><span class="o">.</span><span class="n">get_points</span><span class="p">()</span>

            <span class="c1"># Calculate velocities at the velocity domain geometry points.</span>
            <span class="c1"># This is from &#39;time + delta_time&#39; to &#39;time&#39; on the partitioning plate.</span>
            <span class="n">partitioned_domain_velocity_vectors</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">calculate_velocities</span><span class="p">(</span>
                <span class="n">partitioned_domain_points</span><span class="p">,</span>
                <span class="n">equivalent_stage_rotation</span><span class="p">,</span>
                <span class="n">delta_time</span><span class="p">)</span>

            <span class="c1"># Convert global 3D velocity vectors to local (magnitude, azimuth, inclination) tuples (one tuple per point).</span>
            <span class="n">partitioned_domain_velocities</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">LocalCartesian</span><span class="o">.</span><span class="n">convert_from_geocentric_to_magnitude_azimuth_inclination</span><span class="p">(</span>
                    <span class="n">partitioned_domain_points</span><span class="p">,</span>
                    <span class="n">partitioned_domain_velocity_vectors</span><span class="p">)</span>

            <span class="c1"># Append results for the current geometry to the final results.</span>
            <span class="n">all_domain_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">partitioned_domain_points</span><span class="p">)</span>
            <span class="n">all_velocities</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">partitioned_domain_velocities</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="calculate-velocities-by-grouping-static-points-into-dynamic-plates">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Calculate velocities by grouping static points into dynamic plates</a><a class="headerlink" href="#calculate-velocities-by-grouping-static-points-into-dynamic-plates" title="Link to this heading"></a></h2>
<div class="line-block">
<div class="line">This example is similar to the above example except it groups velocities by partitioning plates.</div>
<div class="line">It is also slightly faster than the above example, but only by one or two percent.</div>
</div>
<section id="id1">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Sample code</a><a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pygplates</span>


<span class="c1"># Load one or more rotation files into a rotation model.</span>
<span class="n">rotation_model</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">RotationModel</span><span class="p">(</span><span class="s1">&#39;rotations.rot&#39;</span><span class="p">)</span>

<span class="c1"># Load the topological plate polygon features.</span>
<span class="n">topology_features</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="s1">&#39;dynamic_polygons.gpml&#39;</span><span class="p">)</span>

<span class="c1"># Load the features that contain the geometries we will calculate velocities at.</span>
<span class="c1"># These can be generated in GPlates via the menu &#39;Features &gt; Generate Velocity Domain Points&#39;.</span>
<span class="n">velocity_domain_features</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="s1">&#39;lat_lon_velocity_domain_90_180.gpml&#39;</span><span class="p">)</span>

<span class="c1"># Calculate velocities using a delta time interval of 1My.</span>
<span class="n">delta_time</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Our geological times will be from 0Ma to &#39;num_time_steps&#39; Ma (inclusive) in 1 My intervals.</span>
<span class="n">num_time_steps</span> <span class="o">=</span> <span class="mi">140</span>

<span class="c1"># &#39;time&#39; = 0, 1, 2, ... , 140</span>
<span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_time_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

    <span class="nb">print</span> <span class="s1">&#39;Time: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">time</span>

    <span class="c1"># All domain points and associated (magnitude, azimuth, inclination) velocities for the current time.</span>
    <span class="n">all_domain_points</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">all_velocities</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Partition our velocity domain features into our topological plate polygons at the current &#39;time&#39;.</span>
    <span class="c1"># Note that we don&#39;t copy plate IDs - we rely on the returned partition grouping instead.</span>
    <span class="n">partitioned_domain_feature_groups</span><span class="p">,</span> <span class="n">unpartitioned_domain_features</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">partition_into_plates</span><span class="p">(</span>
        <span class="n">topology_features</span><span class="p">,</span>
        <span class="n">rotation_model</span><span class="p">,</span>
        <span class="n">velocity_domain_features</span><span class="p">,</span>
        <span class="c1"># We&#39;ll get plate ID directly from partitioning plate instead of assigned plate ID in partitioned feature...</span>
        <span class="n">properties_to_copy</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">reconstruction_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">,</span>
        <span class="n">partition_return</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">PartitionReturn</span><span class="o">.</span><span class="n">partitioned_groups_and_unpartitioned</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">partitioning_plate</span><span class="p">,</span> <span class="n">partitioned_domain_features</span> <span class="ow">in</span> <span class="n">partitioned_domain_feature_groups</span><span class="p">:</span>

        <span class="c1"># All domain points and associated velocities in the current partitioning plate.</span>
        <span class="n">all_domain_points_in_partitioning_plate</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_velocities_in_partitioning_plate</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># We need the partitioning plate ID to get the equivalent stage rotation of that tectonic plate.</span>
        <span class="n">partitioning_plate_id</span> <span class="o">=</span> <span class="n">partitioning_plate</span><span class="o">.</span><span class="n">get_feature</span><span class="p">()</span><span class="o">.</span><span class="n">get_reconstruction_plate_id</span><span class="p">()</span>

        <span class="c1"># Get the stage rotation of partitioning plate from &#39;time + delta_time&#39; to &#39;time&#39;.</span>
        <span class="n">equivalent_stage_rotation</span> <span class="o">=</span> <span class="n">rotation_model</span><span class="o">.</span><span class="n">get_rotation</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">partitioning_plate_id</span><span class="p">,</span> <span class="n">time</span> <span class="o">+</span> <span class="n">delta_time</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">partitioned_domain_feature</span> <span class="ow">in</span> <span class="n">partitioned_domain_features</span><span class="p">:</span>

            <span class="c1"># A velocity domain feature usually has a single geometry but we&#39;ll assume it can be any number.</span>
            <span class="c1"># Iterate over them all.</span>
            <span class="k">for</span> <span class="n">partitioned_domain_geometry</span> <span class="ow">in</span> <span class="n">partitioned_domain_feature</span><span class="o">.</span><span class="n">get_geometries</span><span class="p">():</span>

                <span class="n">partitioned_domain_points</span> <span class="o">=</span> <span class="n">partitioned_domain_geometry</span><span class="o">.</span><span class="n">get_points</span><span class="p">()</span>

                <span class="c1"># Calculate velocities at the velocity domain geometry points.</span>
                <span class="c1"># This is from &#39;time + delta_time&#39; to &#39;time&#39; on the partitioning plate.</span>
                <span class="n">partitioned_domain_velocity_vectors</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">calculate_velocities</span><span class="p">(</span>
                    <span class="n">partitioned_domain_points</span><span class="p">,</span>
                    <span class="n">equivalent_stage_rotation</span><span class="p">,</span>
                    <span class="n">delta_time</span><span class="p">)</span>

                <span class="c1"># Convert global 3D velocity vectors to local (magnitude, azimuth, inclination) tuples (one tuple per point).</span>
                <span class="n">partitioned_domain_velocities</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">LocalCartesian</span><span class="o">.</span><span class="n">convert_from_geocentric_to_magnitude_azimuth_inclination</span><span class="p">(</span>
                        <span class="n">partitioned_domain_points</span><span class="p">,</span>
                        <span class="n">partitioned_domain_velocity_vectors</span><span class="p">)</span>

                <span class="c1"># Append results for the current geometry to the final results.</span>
                <span class="n">all_domain_points_in_partitioning_plate</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">partitioned_domain_points</span><span class="p">)</span>
                <span class="n">all_velocities_in_partitioning_plate</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">partitioned_domain_velocities</span><span class="p">)</span>

        <span class="n">all_domain_points</span><span class="p">[</span><span class="n">partitioning_plate_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_domain_points_in_partitioning_plate</span>
        <span class="n">all_velocities</span><span class="p">[</span><span class="n">partitioning_plate_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_velocities_in_partitioning_plate</span>
</pre></div>
</div>
</section>
</section>
<section id="calculate-velocities-by-individually-partitioning-each-static-point-into-dynamic-plates">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Calculate velocities by individually partitioning each static point into dynamic plates</a><a class="headerlink" href="#calculate-velocities-by-individually-partitioning-each-static-point-into-dynamic-plates" title="Link to this heading"></a></h2>
<div class="line-block">
<div class="line">This example is <strong>ten times slower</strong> than the above two examples.</div>
<div class="line">However it has the advantage of keeping the output velocities (and domain positions) in the same
order as the input domain points (ie, the order of points in each domain multipoint).</div>
</div>
<section id="id2">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Sample code</a><a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pygplates</span>


<span class="c1"># Load one or more rotation files into a rotation model.</span>
<span class="n">rotation_model</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">RotationModel</span><span class="p">(</span><span class="s1">&#39;rotations.rot&#39;</span><span class="p">)</span>

<span class="c1"># Load the topological plate polygon features.</span>
<span class="n">topology_features</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="s1">&#39;dynamic_polygons.gpml&#39;</span><span class="p">)</span>

<span class="c1"># Load the features that contain the geometries we will calculate velocities at.</span>
<span class="c1"># These can be generated in GPlates via the menu &#39;Features &gt; Generate Velocity Domain Points&#39;.</span>
<span class="n">velocity_domain_features</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="s1">&#39;lat_lon_velocity_domain_90_180.gpml&#39;</span><span class="p">)</span>

<span class="c1"># Calculate velocities using a delta time interval of 1My.</span>
<span class="n">delta_time</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Our geological times will be from 0Ma to &#39;num_time_steps&#39; Ma (inclusive) in 1 My intervals.</span>
<span class="n">num_time_steps</span> <span class="o">=</span> <span class="mi">140</span>

<span class="c1"># &#39;time&#39; = 0, 1, 2, ... , 140</span>
<span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_time_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

    <span class="nb">print</span> <span class="s1">&#39;Time: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">time</span>

    <span class="c1"># All domain points and associated (magnitude, azimuth, inclination) velocities for the current time.</span>
    <span class="n">all_domain_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_velocities</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Partition our velocity domain features into our topological plate polygons at the current &#39;time&#39;.</span>
    <span class="n">plate_partitioner</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">PlatePartitioner</span><span class="p">(</span><span class="n">topology_features</span><span class="p">,</span> <span class="n">rotation_model</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">velocity_domain_feature</span> <span class="ow">in</span> <span class="n">velocity_domain_features</span><span class="p">:</span>

        <span class="c1"># A velocity domain feature usually has a single geometry but we&#39;ll assume it can be any number.</span>
        <span class="c1"># Iterate over them all.</span>
        <span class="k">for</span> <span class="n">velocity_domain_geometry</span> <span class="ow">in</span> <span class="n">velocity_domain_feature</span><span class="o">.</span><span class="n">get_geometries</span><span class="p">():</span>

            <span class="k">for</span> <span class="n">velocity_domain_point</span> <span class="ow">in</span> <span class="n">velocity_domain_geometry</span><span class="o">.</span><span class="n">get_points</span><span class="p">():</span>

                <span class="n">all_domain_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">velocity_domain_point</span><span class="p">)</span>

                <span class="n">partitioning_plate</span> <span class="o">=</span> <span class="n">plate_partitioner</span><span class="o">.</span><span class="n">partition_point</span><span class="p">(</span><span class="n">velocity_domain_point</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">partitioning_plate</span><span class="p">:</span>

                    <span class="c1"># We need the newly assigned plate ID to get the equivalent stage rotation of that tectonic plate.</span>
                    <span class="n">partitioning_plate_id</span> <span class="o">=</span> <span class="n">partitioning_plate</span><span class="o">.</span><span class="n">get_feature</span><span class="p">()</span><span class="o">.</span><span class="n">get_reconstruction_plate_id</span><span class="p">()</span>

                    <span class="c1"># Get the stage rotation of partitioning plate from &#39;time + delta_time&#39; to &#39;time&#39;.</span>
                    <span class="n">equivalent_stage_rotation</span> <span class="o">=</span> <span class="n">rotation_model</span><span class="o">.</span><span class="n">get_rotation</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">partitioning_plate_id</span><span class="p">,</span> <span class="n">time</span> <span class="o">+</span> <span class="n">delta_time</span><span class="p">)</span>

                    <span class="c1"># Calculate velocity at the velocity domain point.</span>
                    <span class="c1"># This is from &#39;time + delta_time&#39; to &#39;time&#39; on the partitioning plate.</span>
                    <span class="n">velocity_vectors</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">calculate_velocities</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">velocity_domain_point</span><span class="p">],</span>
                        <span class="n">equivalent_stage_rotation</span><span class="p">,</span>
                        <span class="n">delta_time</span><span class="p">)</span>

                    <span class="c1"># Convert global 3D velocity vectors to local (magnitude, azimuth, inclination) tuples (one tuple per point).</span>
                    <span class="n">velocities</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">LocalCartesian</span><span class="o">.</span><span class="n">convert_from_geocentric_to_magnitude_azimuth_inclination</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">velocity_domain_point</span><span class="p">],</span>
                            <span class="n">velocity_vectors</span><span class="p">)</span>
                    <span class="n">all_velocities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">velocities</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">all_velocities</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pygplates_calculate_velocities_by_plate_id.html" class="btn btn-neutral float-left" title="Calculate velocities by plate ID" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pygplates_find_nearest_feature_to_a_point.html" class="btn btn-neutral float-right" title="Find nearest reconstructed feature to a point" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright (C) 2003-2025 The University of Sydney, Australia
(C) 2004-2025 California Institute of Technology
(C) 2007-2025 The Geological Survey of Norway
.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>